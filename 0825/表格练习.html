<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>练习题一</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        #box {
            width: 900px;
            margin: auto;
        }

        .btn-list {
            margin: 10px 0;
        }

        .table1 {
            border: 1px solid black;
            width: 900px;
            margin: auto;
            text-align: center;
            border-collapse: collapse;
            border-spacing: 0px;
        }

        .table1>tr {
            height: 40px;
        }

        button {
            padding: 5px;
            color: #fff;
            border: none;
            border-radius: 5px;
        }

        .btn-edit {
            background-color: #f9a908;
        }

        .btn-remove {
            background-color: #f60300;
        }

        .table1>tr>td,
        .table1>tbody>tr>th {
            border: 1px solid black;
        }

        .box-title {
            text-align: center;
        }


        .btn-list>button {
            padding: 10px 20px;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 20px;
        }

        .btn-list>.box-btn-add {
            background-color: #30a9af;
        }

        .btn-list>.box-btn-edit {
            background-color: #f9a908;
        }

        .btn-list>.box-btn-remove {
            background-color: #f60300;
        }

        .mask,
        .mask2 {
            position: fixed;
            right: 0;
            left: 0;
            top: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.3);
            /* display: flex; */
            justify-content: center;
            align-items: center;
        }

        .mask>.form,
        .mask2>.form {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 300px;
            height: 400px;
            background-color: #dee1e6;

        }

        .mask>.form>h2,
        .mask2>.form>h2 {
            margin-bottom: 20px;
        }

        .mask>.form>.form-item,
        .mask2>.form>.form-item {
            margin-bottom: 15px;
        }


        .visible {
            display: flex;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <div id="box">
        <h2 class="box-title">学生信息列表</h2>
        <div class="btn-list">
            <button type="button" class="box-btn-add" onclick="vb2()">新增</button>
            <button type="button" class="box-btn-remove" onclick="deleteAllck()">批量删除</button>
        </div>
        <table class="table1">
            <tr>
                <th>
                    <label>
                        <input type="checkbox" name="all" id="chooseAll" onclick="checkedAll()">
                        全选
                    </label>
                </th>
                <th>姓名</th>
                <th>性别</th>
                <th>年龄</th>
                <th>爱好</th>
                <th>操作</th>
            </tr>

        </table>

        <div class="mask hidden">
            <form class="form">
                <h2>编辑</h2>
                <div class="form-item">
                    <label>
                        姓名:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="form-item">
                    <label>
                        性别:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="form-item">
                    <label>
                        年龄:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="form-item">
                    <label>
                        爱好:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="btn-boxs">
                    <button type="button" class="btn-edit" onclick="save()">保存</button>
                    <button type="button" class="btn-remove" onclick="hd1()">取消</button>
                </div>
            </form>
        </div>
        <div class="mask2 hidden">
            <form class="form">
                <h2>新增</h2>
                <div class="form-item">
                    <label>
                        姓名:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="form-item">
                    <label>
                        性别:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="form-item">
                    <label>
                        年龄:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="form-item">
                    <label>
                        爱好:
                        <input type="text" name="in-data">
                    </label>
                </div>
                <div class="btn-boxs">
                    <button type="button" class="btn-edit" onclick="newAdd()">新增</button>
                    <button type="button" class="btn-remove" onclick="hd2()">取消</button>
                </div>
            </form>
        </div>
    </div>
</body>
<script>
    var stus = [
        {
            stuName: "张三",
            sex: "女",
            age: 18,
            hobby: ["看书", "睡觉", "打豆豆"]
        },
        {
            stuName: "李四",
            sex: "女",
            age: 22,
            hobby: ["看书", "睡觉", "吃"]
        },
        {
            stuName: "王五",
            sex: "男",
            age: 18,
            hobby: ["看书", "睡觉", "喝"]
        },
        {
            stuName: "赵六",
            sex: "男",
            age: 30,
            hobby: ["看书", "睡觉"]
        },
        {
            stuName: "田七",
            sex: "女",
            age: 19,
            hobby: ["看书", "睡觉"]
        },
        {
            stuName: "周八",
            sex: "女",
            age: 22,
            hobby: ["看书", "睡觉"]
        }
    ]


    //排序
    stus.sort((a, b) => a.age - b.age);
    let box = document.querySelector("#box");
    let table1 = document.querySelector(".table1");
    let chooseAll = document.querySelector("#chooseAll"); //全选的复选框
    let removeAll = document.querySelector(".box-btn-remove"); //批量删除按钮
    let currentItem = null;
    let currentData = [];




    //放入数据
    stus.forEach((i) => {
        let tr2 = document.createElement("tr");
        table1.appendChild(tr2);
        let td1 = document.createElement("td");
        td1.innerHTML = "<input type='checkbox' name='choose' >";
        tr2.appendChild(td1);
        let arr = Object.getOwnPropertyNames(i);  //对象属性名转数组
        arr.forEach((item) => {
            let td2 = document.createElement("td");
            td2.innerHTML = i[item];
            tr2.appendChild(td2);
        })
        let td3 = document.createElement("td");
        td3.innerHTML = "<button type='button' class='btn-edit'>编辑</button><button class='btn-remove'>删除</button>";
        tr2.appendChild(td3);
    })

    table1.onclick = function (e) {
        //单行删除
        if (e.target.matches(".table1 tr td .btn-remove")) {
            e.target.parentElement.parentElement.remove();
        }
        //单复选框
        if (e.target.matches(".table1 tr td [name='choose']")) {
            let checkboxs = document.querySelectorAll(".table1 tr td [name='choose']"); //除全选外所有复选框
            let checkeds = document.querySelectorAll(".table1 tr td [name='choose']:checked"); //选中的复选框
            chooseAll.checked = checkboxs.length === checkeds.length;
        }

        //编辑按钮
        if (e.target.matches(".table1 tr td .btn-edit")) {

            let mask = document.querySelector('.mask');
            mask.classList.remove("hidden");
            mask.classList.add("visible");
            currentItem = e.target.parentElement.parentElement.children; //取数据
            new Array().forEach.call(currentItem, (i, index) => {
                if (index != 0 && index != 5) {
                    currentData[index - 1] = i.innerText;
                }
            })
            let inputs = document.querySelectorAll(".mask .form .form-item [name='in-data']")
            inputs.forEach((i, index) => {
                i.value = currentData[index];
            })

        }

    }

    //隐藏1
    function hd1() {
        let mask = document.querySelector('.mask');
        mask.classList.remove("visible");
        mask.classList.add("hidden");
    }
    function hd2() {
        let mask = document.querySelector('.mask2');
        mask.classList.remove("visible");
        mask.classList.add("hidden");
    }

    //显示2
    function vb2() {
        let mask = document.querySelector('.mask2');
        mask.classList.remove("hidden");
        mask.classList.add("visible");
    }


    //全选
    function checkedAll() {
        let checkboxs = document.querySelectorAll(".table1 tr td [name='choose']");
        checkboxs.forEach(i => {
            i.checked = chooseAll.checked;
        })
    }

    //批量删除
    function deleteAllck() {
        let checkeds = document.querySelectorAll(".table1 tr td [name='choose']:checked"); //选中的复选框
        checkeds.forEach(i => {
            i.parentElement.parentElement.remove();
        })
    }

    //编辑保存
    function save() {
        let inputs = document.querySelectorAll(".mask .form .form-item [name='in-data']");
        inputs.forEach((i, index) => {
            currentData[index] = i.value;
        })
        new Array().forEach.call(currentItem, (i, index) => {
            if (index != 0 && index != 5) {
                currentItem[index].innerText = currentData[index - 1]
            }
        })
        hd1()
    }

    //新增
    function newAdd() {
        let datas = document.querySelectorAll(".mask2>.form>.form-item [name='in-data']"); //弹窗内输入框
        datas.forEach((i, index) => {
            currentData[index] = i.value;  //输入框数据暂存
        })
        if (currentData[0] === "" || currentData[1] === "" || currentData[3] === "") {  //判断是否为空
            alert('请输入数据');
            return;
        } else {
            let tr = document.createElement("tr");
            let str = "<td><input type='checkbox' name='choose'></td><td>"
                + currentData[0] + "</td>" + "<td>" + currentData[1] + "</td>" + "<td>" + currentData[2] + "</td>" + "<td>" + currentData[3] + "</td>"
                + "<td><button type='button' class='btn-edit' onclick='save()' >编辑</button><button class='btn-remove' onclick='hd2()' >删除</button></td>";
            currentData = [];
            datas.forEach((i, index) => {
                i.value = "";  //初始化
            })
            tr.innerHTML = str;
            table1.appendChild(tr);
            hd2();
        }
    }




</script>